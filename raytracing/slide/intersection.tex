% --- Section 5: Intersection Algorithms ---
\section{Ray-Object Intersections}

\begin{frame}{The Heart of Ray Tracing}
    \begin{center}
        \huge \textcolor{PrimaryColor}{Finding Intersections}
    \end{center}

    \vspace{0.5cm}
    \begin{columns}
        \begin{column}{0.5\textwidth}
            \begin{tikzpicture}[scale=0.8]
                % Ray
                \draw[ray, very thick] (0,0) -- (4,2);
                \node[below] at (0,0) {\raycolor{Ray}};

                % Various objects
                \node[sphere] (sphere) at (2,1) {};
                \node[plane, rotate=30] (plane) at (3,0.5) {};
                \node[triangle] (tri) at (1,2) {};

                % Intersection points
                \fill[AccentColor] (1.5,0.75) circle (2pt);
                \fill[AccentColor] (2,1) circle (2pt);

                \node[right] at (4,2) {\small Different objects, different math!};
            \end{tikzpicture}
        \end{column}
        \begin{column}{0.5\textwidth}
            \textbf{Key Objects:}
            \begin{itemize}
                \item \objectcolor{Planes} - Linear equations
                \item \objectcolor{Spheres} - Quadratic equations
                \item \objectcolor{Triangles} - Barycentric coordinates
                \item \objectcolor{General Quadrics} - Polynomial solving
            \end{itemize}
            \vspace{0.5cm}
            \alert{Challenge:} Find the \textbf{closest} intersection efficiently!
        \end{column}
    \end{columns}
\end{frame}

\begin{frame}{Ray-Plane Intersection}
    \begin{columns}
        \begin{column}{0.5\textwidth}
            \begin{mathbox}{Plane Equation}
                Implicit form:
                \begin{align}
                    \mathbf{n} \cdot \mathbf{P} + D & = 0
                \end{align}

                Substituting ray equation:
                \begin{align}
                    \mathbf{n} \cdot (\mathbf{R_o} + t\mathbf{R_d}) + D & = 0                                                                        \\
                    t                                                   & = -\frac{D + \mathbf{n} \cdot \mathbf{R_o}}{\mathbf{n} \cdot \mathbf{R_d}}
                \end{align}
            \end{mathbox}
        \end{column}
        \begin{column}{0.5\textwidth}
            \begin{tikzpicture}[scale=0.8]
                % Plane
                \draw[thick, ObjectColor] (-1,0) -- (3,2);
                \node[below] at (1,1) {\objectcolor{Plane}};

                % Normal vector
                \draw[->, thick, SecondaryColor] (1,1) -- (0.5,2);
                \node[left] at (0.5,2) {$\mathbf{n}$};

                % Ray
                \draw[ray] (-0.5,0.5) -- (2.5,1.5);
                \node[below] at (-0.5,0.5) {$\mathbf{R_o}$};
                \node[above] at (1.5,1.2) {$\mathbf{R_d}$};

                % Intersection point
                \fill[AccentColor] (1,1) circle (3pt);
                \node[above] at (1,1) {\textcolor{AccentColor}{Intersection}};

                % Distance illustration
                \draw[dashed, thin] (1,1) -- (1,0);
                \node[below] at (1,0) {$d$};
            \end{tikzpicture}
        \end{column}
    \end{columns}

    \begin{conceptbox}{Key Insight}
        \textbf{Explicit} ray equation meets \textbf{implicit} plane equation = Clean intersection formula!
    \end{conceptbox}
\end{frame}

\begin{frame}{Ray-Sphere Intersection}
    \begin{columns}
        \begin{column}{0.5\textwidth}
            \begin{mathbox}{Sphere Equation}
                Implicit form (centered at origin):
                \begin{align}
                    \mathbf{P} \cdot \mathbf{P} - r^2 & = 0
                \end{align}

                Substituting ray equation:
                \begin{align}
                     & (\mathbf{R_o} + t\mathbf{R_d}) \cdot (\mathbf{R_o} + t\mathbf{R_d}) - r^2 = 0           \\
                     & t^2 + 2(\mathbf{R_d} \cdot \mathbf{R_o})t + (\mathbf{R_o} \cdot \mathbf{R_o} - r^2) = 0
                \end{align}

                Quadratic formula: $t = \frac{-b \pm \sqrt{b^2-4ac}}{2a}$
            \end{mathbox}
        \end{column}
        \begin{column}{0.5\textwidth}
            \begin{tikzpicture}[scale=0.8]
                % Sphere
                \draw[thick, ObjectColor] (0,0) circle (1.5);
                \node[below] at (0,-1.8) {\objectcolor{Sphere}};

                % Center
                \fill[ObjectColor] (0,0) circle (2pt);
                \node[below left] at (0,0) {$\mathbf{O}$};

                % Radius
                \draw[thin, ObjectColor] (0,0) -- (1.5,0);
                \node[below] at (0.75,0) {$r$};

                % Ray with two intersections
                \draw[ray] (-2,-0.5) -- (2,0.5);

                % Intersection points
                \fill[AccentColor] (-1.3,-0.35) circle (2pt);
                \fill[AccentColor] (1.3,0.35) circle (2pt);
                \node[above] at (-1.3,-0.35) {$t_1$};
                \node[above] at (1.3,0.35) {$t_2$};

                % Discriminant cases
                \node[right] at (2.5,1) {
                    \begin{minipage}{2cm}
                        \tiny
                        $\Delta > 0$: 2 roots\\
                        $\Delta = 0$: 1 root\\
                        $\Delta < 0$: no roots
                    \end{minipage}
                };
            \end{tikzpicture}
        \end{column}
    \end{columns}
\end{frame}

\begin{frame}{Ray-Triangle Intersection}
    \begin{columns}
        \begin{column}{0.5\textwidth}
            \begin{mathbox}{Barycentric Approach}
                Triangle defined by vertices $\mathbf{a}$, $\mathbf{b}$, $\mathbf{c}$:
                \begin{align}
                    \mathbf{P}(\beta,\gamma) & = \mathbf{a} + \beta(\mathbf{b}-\mathbf{a}) + \gamma(\mathbf{c}-\mathbf{a})
                \end{align}

                Set equal to ray equation:
                \begin{align}
                    \mathbf{R_o} + t\mathbf{R_d} & = \mathbf{a} + \beta(\mathbf{b}-\mathbf{a}) + \gamma(\mathbf{c}-\mathbf{a})
                \end{align}

                Solve 3Ã—3 system for $t$, $\beta$, $\gamma$
            \end{mathbox}
        \end{column}
        \begin{column}{0.5\textwidth}
            \begin{tikzpicture}[scale=0.8]
                % Triangle
                \coordinate (A) at (0,0);
                \coordinate (B) at (3,0);
                \coordinate (C) at (1.5,2.5);

                \draw[thick, ObjectColor, fill=ObjectColor!20] (A) -- (B) -- (C) -- cycle;

                % Vertices
                \fill[ObjectColor] (A) circle (2pt);
                \fill[ObjectColor] (B) circle (2pt);
                \fill[ObjectColor] (C) circle (2pt);
                \node[below left] at (A) {$\mathbf{a}$};
                \node[below right] at (B) {$\mathbf{b}$};
                \node[above] at (C) {$\mathbf{c}$};

                % Ray
                \draw[ray] (-1,1) -- (2.5,1.5);

                % Intersection point
                \fill[AccentColor] (1.2,1.2) circle (2pt);

                % Barycentric coordinates illustration
                \draw[thin, SecondaryColor] (A) -- (1.2,1.2);
                \draw[thin, SecondaryColor] (B) -- (1.2,1.2);
                \draw[thin, SecondaryColor] (C) -- (1.2,1.2);

                \node[right] at (3.5,1.5) {
                    \begin{minipage}{2cm}
                        \tiny
                        Inside if:\\
                        $\beta \geq 0$\\
                        $\gamma \geq 0$\\
                        $\beta + \gamma \leq 1$
                    \end{minipage}
                };
            \end{tikzpicture}
        \end{column}
    \end{columns}
\end{frame}