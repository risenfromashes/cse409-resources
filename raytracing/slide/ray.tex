\section{Mathematics of Rays}
\begin{frame}{What is a Ray?}
    \begin{columns}
        \begin{column}{0.5\textwidth}
            \begin{mathbox}{Ray Representation}
                A ray is defined by:
                \begin{align}
                    \mathbf{P}(t) & = \mathbf{R_o} + t \cdot \mathbf{R_d}
                \end{align}
                where:
                \begin{itemize}
                    \item $\mathbf{R_o}$ = Origin point
                    \item $\mathbf{R_d}$ = Direction vector
                    \item $t$ = Parameter ($t \geq 0$)
                \end{itemize}
            \end{mathbox}
            \vspace{0.3cm}
            \href{https://www.desmos.com/calculator/0tloiudmdt}{Check out here on desmos.}
        \end{column}
        \begin{column}{0.5\textwidth}
            \begin{tikzpicture}[scale=0.8]
                % Origin

                % Points on ray
                \fill[SecondaryColor] (2,1.5) circle (3pt);
                \node[below] at (2,1) {$\mathbf{P}(t_1)$};
                \fill[SecondaryColor] (4,3) circle (3pt);
                \node[below] at (4,2.75) {$\mathbf{P}(t_2)$};


                % Direction vector
                \draw[->, very thick, red] (0,0) -- (2,1.5);
                \node[above] at (0.8,0.9) {$\mathbf{R_d}$};

                % Ray continuation
                \draw[ray, dashed] (2,1.5) -- (5,3.75);

                \fill[PrimaryColor] (0,0) circle (3pt);
                \node[below left] at (0,0) {$\mathbf{R_o}$};

                % Parameter illustration
                \draw[<->, thin] (0,-1) -- (2,-1);
                \node[below] at (1,-1) {$t_1=1$};
                \draw[<->, thin] (0,-2) -- (4,-2);
                \node[below] at (2,-2) {$t_2$};
            \end{tikzpicture}
        \end{column}
    \end{columns}
\end{frame}


\begin{frame}{The Heart of Ray Tracing}
    \begin{center}
        \huge \textcolor{PrimaryColor}{Finding Intersections}
    \end{center}

    \vspace{0.5cm}
    \begin{columns}
        \begin{column}{0.5\textwidth}
            \begin{tikzpicture}[scale=0.8]
                % Ray
                \draw[ray, very thick] (1.5,0.75) -- (4, 2);

                % Various objects
                \node[sphere] (sphere) at (2,1) {};
                \node[plane, rotate=30] (plane) at (3,0.5) {};
                \node[triangle] (tri) at (1,2) {};

                % Intersection points
                \fill[AccentColor] (1.5,0.75) circle (2pt);
                \fill[AccentColor] (2.5,1.25) circle (2pt);

                \draw[RayColor, very thick] (0,0) -- (1.5,0.75);
                \draw[RayColor, very thick, opacity=0.3] (1.5,0.75) -- (2.85,1.425);
                \node[below] at (0,0) {\raycolor{Ray}};

            \end{tikzpicture}
        \end{column}
        \begin{column}{0.5\textwidth}
            \textbf{Key Objects:}
            \begin{itemize}
                \item \objectcolor{Planes}
                \item \objectcolor{Spheres}
                \item \objectcolor{Triangles}
                \item \objectcolor{General Quadrics}
            \end{itemize}
            \vspace{0.5cm}
            \alert{Challenge:} Find the \textbf{closest} intersection efficiently!
        \end{column}
    \end{columns}
\end{frame}


\begin{frame}{3D Plane Representation}
    \begin{columns}
        \begin{column}{0.65\textwidth}
            \begin{mathbox}{Plane Definition}
                A plane is defined by:
                \begin{itemize}
                    \item Point $\mathbf{P_0} = (x_0, y_0, z_0)$ on plane
                    \item Normal vector $\mathbf{n} = (A, B, C)$
                \end{itemize}
                \textbf{Implicit equation:}
                \vspace*{-0.3cm}
                \begin{align*}
                    & \mathbf{n} \cdot (\mathbf{P} - \mathbf{P_0}) = 0 \\
                    & \boxed{\mathbf{n} \cdot \mathbf{P} + D = 0} \text{ where }  D = -\mathbf{n} \cdot \mathbf{P_0} \\
                    & \boxed{A x + B y + C z + D = 0}\\
                \end{align*}
            \end{mathbox}
        \end{column}
        \begin{column}{0.35\textwidth}
            \begin{tikzpicture}[scale=0.6]
                % 3D coordinate system
                \draw[->] (0,0) -- (3,0) node[right] {$x$};
                \draw[->] (0,0) -- (0,3) node[above] {$y$};
                \draw[->] (0,0) -- (-1,-1) node[below left] {$z$};
                
                % 3D Plane using canvas transformation
                \begin{scope}[
                    plane origin={(2,1,0)},
                    plane x={(0.707,0, 0.707)},
                    plane y={(0,0.707,-0.707)},
                    canvas is plane]
                    \draw[thick, ObjectColor, fill=ObjectColor!20, opacity=0.6] 
                        (-1, -1) -- (-1, 1) -- (1, 1) -- (1, -1) -- cycle;

                    \only<1>{
                    \fill[AccentColor] (0.5,0.5) circle (2pt);
                    \node[above] at (0.5,0.5) {$\mathbf{P}$};
                    \draw[dashed, thin] (0, 0) -- (0.5,0.5);
                    }
                \end{scope}
                
                % Point on plane
                \fill[ObjectColor] (2,1,0) circle (2pt);
                \node[above right] at (2,1, 0) {$\mathbf{P_0}$};
                
                % Normal vector
                \draw[->, thick, SecondaryColor] (2, 1, 0) -- (1,2,-1);
                \node[above] at (1,2.5) {$\mathbf{n}$};
                
                \pause
                % Test point
                
                % Distance illustration
                \fill[AccentColor] (-0.5,2) circle (2pt);
                \node[above] at (-0.5,2) {$\mathbf{P}$};
                \draw[dashed, thin] (-0.5,2,0) -- (1,0.5,1.5) node[midway, left] {$d$};
            \end{tikzpicture}
        \end{column}
    \end{columns}
    \only<2->{
        \begin{conceptbox}{Point-Plane Distance}
            If $\mathbf{n}$ is normalized: $d = \mathbf{n} \cdot \mathbf{P} + D = \mathbf{n} \cdot (\mathbf{P} - \mathbf{P_0})$ \\
            \textbf{Signed distance:} $d > 0$ (front), $d < 0$ (back), $d = 0$ (on plane)
        \end{conceptbox}
    }
\end{frame}

\begin{frame}{Ray-Plane Intersection}
    \begin{columns}
        \begin{column}{0.6\textwidth}
            \begin{mathbox}{Intersection Method}
                \textbf{Step 1:} Substitute ray into equation
                \begin{align*}
                    \mathbf{n} \cdot (\mathbf{R_o} + t\mathbf{R_d}) + D &= 0\\
                    \mathbf{n} \cdot \mathbf{R_o} + t(\mathbf{n} \cdot \mathbf{R_d}) + D &= 0
                \end{align*}
                
                \textbf{Step 2:} Solve for parameter $t$
                \begin{align*}
                    \boxed{t = -\frac{D + \mathbf{n} \cdot \mathbf{R_o}}{\mathbf{n} \cdot \mathbf{R_d}}}
                \end{align*}
            \end{mathbox}
        \end{column}
        \begin{column}{0.4\textwidth}
            \begin{tikzpicture}[scale=0.8]
                % 3D Plane
                \begin{scope}[canvas is xy plane at z=0.3, transform shape]
                    \draw[thick, ObjectColor, fill=ObjectColor!20] 
                        (-0.5,0.5) -- (2.5,0.5) -- (3,2) -- (0,2) -- cycle;
                \end{scope}
                
                % Normal vector
                \draw[->, thick, SecondaryColor] (1.25,1.25) -- (0.75,2.25);
                \node[left] at (0.75,2.25) {$\mathbf{n}$};
                
                % Ray
                \draw[ray, very thick] (-1,-1) -- (2.5,2.5);
                \node[below] at (-1,-1) {$\mathbf{R_o}$};
                \draw[->, red, thick] (-1,-1) -- (0,0) node[midway, right] {$\mathbf{R_d}$};
                
                % Intersection point
                \fill[AccentColor] (1.25,1.25) circle (3pt);
                \node[left] at (1.25,1.25) {\textcolor{AccentColor}{$\mathbf{P}(t)$}};
                
                % Parameter illustration
                \draw[<->, thin] (-1,-2) -- (1.25,-2) node[midway, below] {$t$};
            \end{tikzpicture}
        \end{column}
    \end{columns}
    \pause
    \begin{conceptbox}{Cases}
        \begin{itemize}
            \item If $\mathbf{n} \cdot \mathbf{R_d} = 0$: Ray parallel to plane (0 or infinite)
            \item If $\mathbf{n} \cdot \mathbf{R_d} < 0$: Ray hits front face
            \item If $\mathbf{n} \cdot \mathbf{R_d} > 0$: Ray hits back face
        \end{itemize}
    \end{conceptbox}
\end{frame}


\begin{frame}{Additional Checks}
    \begin{columns}
        \begin{column}{0.6\textwidth}
            \begin{mathbox}{Validation Rules}
                After computing $t$, verify:
                \begin{enumerate}
                    \item \textbf{Behind check:} $t > t_{\text{min}}$
                    \item \textbf{Closest check:} $t < t_{\text{current}}$
                    \item \textbf{Valid range:} $t \geq 0$
                \end{enumerate}
                
                Where:
                \begin{itemize}
                    \item $t_{\text{min}}$: Minimum ray distance (not behind eye/screen)
                    \item $t_{\text{current}}$: Distance to closest intersection so far
                \end{itemize}
            \end{mathbox}
        \end{column}
        \begin{column}{0.4\textwidth}
            \begin{tikzpicture}[scale=0.7]
                % Ray origin
                
                % Ray direction
                \draw[ray, very thick] (0,0) -- (5,2.5);
                
                % t_min region
                \draw[red, very thick] (0,0) -- (1.5,0.75) node[midway, above, xshift=-0.5cm] {\textcolor{red}{$t < t_{\text{min}}$}};

                \node[eye] (eye) at (1.5,0.75) {\faIcon{eye}};
                
                % Valid intersection
                \draw[green, very thick] (eye) -- (3.5,1.75) node[midway, below, yshift=-0.1cm] {\textcolor{green}{Valid}};
                
                % Too far intersection
                \fill[orange] (3.5,1.75) circle (3pt);
                \node[above, yshift=0.5cm, xshift=0.25cm] at (3.5,1.75) {\textcolor{orange}{$t > t_{\text{current}}$}};
                
                % Behind ray
                \fill[red] (-1,-0.5) circle (3pt);
                \node[below] at (-1,-0.5) {\textcolor{red}{$t < 0$}};
                \draw[red, dashed] (0,0) -- (-1,-0.5);

                \fill[PrimaryColor] (0,0) circle (3pt);
                \node[below] at (0.1,-0.1) {$\mathbf{R_o}$};
            \end{tikzpicture}
        \end{column}
    \end{columns}    

\end{frame}

\begin{frame}{Ray-Triangle Intersection Overview}
    \begin{columns}
        \begin{column}{0.65\textwidth}
            \begin{conceptbox}{Two Main Approaches}
                \textbf{Method 1: Two-Step Process}
                \begin{enumerate}
                    \item Ray-plane intersection
                    \item Inside/outside triangle test
                \end{enumerate}
                
                \vspace{0.5cm}
                \textbf{Method 2: Direct Barycentric}
                \begin{enumerate}
                    \item Set up 3Ã—3 linear system
                    \item Solve for t, $\beta$, $\gamma$ simultaneously
                \end{enumerate}
            \end{conceptbox}
        \end{column}
        \begin{column}{0.35\textwidth}
            \begin{tikzpicture}[scale=0.6]
                \begin{scope}[plane x={(0.707, 0, 0.707)}, plane y={(0, 0.9, -0.436)}, canvas is plane]
                    % Triangle vertices in 3D space
                    \coordinate (A) at (0,0);
                    \coordinate (B) at (3,0);
                    \coordinate (C) at (1.5,2.5);
                    
                    % Triangle
                    \draw[thick, ObjectColor, fill=ObjectColor!20, opacity=0.7] (A) -- (B) -- (C) -- cycle;
                    
                    % Vertices
                    \fill[ObjectColor] (A) circle (2pt);
                    \fill[ObjectColor] (B) circle (2pt);
                    \fill[ObjectColor] (C) circle (2pt);
                    \node[below] at (A) {$\mathbf{a}$};
                    \node[below] at (B) {$\mathbf{b}$};
                    \node[above] at (C) {$\mathbf{c}$};
                \end{scope}
                
                % Ray coming from above
                \begin{scope}[canvas is xy plane at z=2]
                    \coordinate (RayStart) at (-1,1);
                \end{scope}
                \begin{scope}[canvas is xy plane at z=0]
                    \coordinate (RayEnd) at (2,1);
                \end{scope}
                
                \draw[ray, very thick] (RayStart) -- (RayEnd);
                \node[above] at (RayStart) {\raycolor{Ray}};
                
                % Intersection point
                \fill[AccentColor] (0.9,0.75) circle (3pt);
                \node[below right, xshift=0.25cm] at (0.9,0.75) {\textcolor{AccentColor}{Intersection}};

                               
                \draw[->, thick, SecondaryColor] (0.9,0.75) -- (-0.3,1.8) node[midway, left] {$\mathbf{n}$};
            \end{tikzpicture}
        \end{column}
    \end{columns}
\end{frame}


\begin{frame}{What Are Barycentric Coordinates?}
    \begin{columns}
        \begin{column}{0.5\textwidth}
            \begin{mathbox}{Barycentric Definition}
                Any point P in the triangle's plane:
                \begin{align*}
                    \mathbf{P}(\alpha,\beta,\gamma) &= \alpha\mathbf{a} + \beta\mathbf{b} + \gamma\mathbf{c}
                \end{align*}
                where: $\alpha + \beta + \gamma = 1$

                \vspace{0.3cm}

                \pause
                \textbf{Physical Interpretation:}
                \begin{itemize}
                    \item $\alpha$, $\beta$, $\gamma$ are \textit{weights}
                    \item P is the \textit{center of mass}
                    \item Also called \textit{barycenter}
                \end{itemize}
            \end{mathbox}
        \end{column}
        \begin{column}{0.5\textwidth}
            \begin{tikzpicture}[scale=0.8]
                \begin{scope}[canvas is xy plane at z=0]
                    % Triangle
                    \coordinate (A) at (0,0);
                    \coordinate (B) at (4,0);
                    \coordinate (C) at (2,3);
                    
                    \draw[thick, ObjectColor, fill=ObjectColor!15] (A) -- (B) -- (C) -- cycle;
                    
                    % Vertices with weights
                    \fill[ObjectColor] (A) circle (3pt);
                    \fill[ObjectColor] (B) circle (3pt);
                    \fill[ObjectColor] (C) circle (3pt);
                    \node[below] at (A) {$\mathbf{a}$ ($\alpha=0.3$)};
                    \node[below] at (B) {$\mathbf{b}$ ($\beta=0.5$)};
                    \node[above] at (C) {$\mathbf{c}$ ($\gamma=0.2$)};
                    
                    % Point P
                    \coordinate (P) at (2.2,1.2);
                    \fill[AccentColor] (P) circle (3pt);
                    \node[left] at (P) {\textcolor{AccentColor}{$\mathbf{P}$}};
                    
                    % Sub-triangles for area interpretation
                    \draw[thin, SecondaryColor, dashed] (P) -- (A);
                    \draw[thin, SecondaryColor, dashed] (P) -- (B);
                    \draw[thin, SecondaryColor, dashed] (P) -- (C);
                    
                    % Area labels
                    \fill[red!15, opacity=0.5] (A) -- (B) -- (P) -- cycle;
                    \fill[green!15, opacity=0.5] (C) -- (B) -- (P) -- cycle;
                    \fill[blue!15, opacity=0.5] (A) -- (C) -- (P) -- cycle;

                    \node[red] at (2.2,0.4) {$A_{\gamma}$};
                    \node[green] at (2.6,1.7) {$A_{\alpha}$};
                    \node[blue] at (1.6,1.7) {$A_{\beta}$};


                \end{scope}
            \end{tikzpicture}
            \vspace{0.3cm}
            \only<3->{
                \begin{conceptbox}{Area Relationship}
                    $\alpha = \frac{A_{\alpha}}{A_{total}}$, $\beta = \frac{A_{\beta}}{A_{total}}$, \\
                    $\gamma = \frac{A_{\gamma}}{A_{total}}$
                \end{conceptbox}
            }
        \end{column}
    \end{columns}
    \href{https://www.desmos.com/calculator/rb2zeav9og}{Check out the Desmos demo.}
\end{frame}



\begin{frame}{Barycentric Coordinates: Inside vs Outside}
    \begin{columns}
        \begin{column}{0.5\textwidth}
            \begin{mathbox}{Triangle Interior Test}
                Point P is \textbf{inside} triangle if:
                \begin{align*}
                    \alpha, \beta, \gamma &\geq 0
                \end{align*}
                
                Since $\alpha + \beta + \gamma = 1$, we can rewrite as:
                \begin{align*}
                    \beta &\geq 0 \\
                    \gamma &\geq 0 \\
                    \alpha &\geq 0 \text{ or } \beta + \gamma \leq 1
                \end{align*}
            \end{mathbox}
        \end{column}
        \begin{column}{0.5\textwidth}
            \begin{tikzpicture}[scale=0.6]
                \begin{scope}[canvas is xy plane at z=0]
                    % Triangle
                    \coordinate (A) at (0,0);
                    \coordinate (B) at (4,0);
                    \coordinate (C) at (2,3);
                    
                    \draw[thick, ObjectColor, fill=ObjectColor!15] (A) -- (B) -- (C) -- cycle;
                    
                    % Vertices
                    \fill[ObjectColor] (A) circle (2pt);
                    \fill[ObjectColor] (B) circle (2pt);
                    \fill[ObjectColor] (C) circle (2pt);
                    \node[below] at (A) {$\mathbf{a}$};
                    \node[below] at (B) {$\mathbf{b}$};
                    \node[above] at (C) {$\mathbf{c}$};
                    
                    % Inside point
                    \fill[AccentColor] (1.5,1) circle (2pt);
                    \node[right, AccentColor] at (1.5,1) {Inside};
                    \node[right, AccentColor] at (0.6,0.3) {\scriptsize $0\geq \beta,\gamma \geq 1$};
                    
                    % Outside points
                    \fill[red] (-0.5,1) circle (2pt);
                    \node[left, red] at (-0.5,1) {Outside};
                    \node[left, red] at (-0.5,0.4) {$\beta<0$};
                    
                    \fill[red] (4,1.5) circle (2pt);
                    \node[above, red] at (5.2,1.1) {Outside};
                    \node[above, red] at (5,1.5) {$\alpha < 0, \beta+\gamma>1$};
                    
                    \fill[red] (1.5,-1.5) circle (2pt);
                    \node[right, red] at (1.5,-1.5) {Outside};
                    \node[right, red] at (1.5,-1) {$\gamma<0$};
                \end{scope}
            \end{tikzpicture}
        \end{column}
    \end{columns}
    \pause
    \begin{conceptbox}{Insight}
        Barycentric coordinates doesn't just tell us if a point is inside a triangle, but also it's position with respect to other vertices.
    \end{conceptbox}
\end{frame}

\begin{frame}{Barycentric Coordinates: Derivation}
    \begin{columns}
        \begin{column}{0.65\textwidth}
            \begin{mathbox}{Key Idea}
                \begin{itemize}
                    \item  The sides
                        $\mathbf{e_1} = \mathbf{b} - \mathbf{a}$ and $\mathbf{e_2} = \mathbf{c} - \mathbf{a}$ are linearly independent vectors on the triangle's plane.
                    \pause
                    \item Therefore, any vector in the triangle's plane (e.g. $\mathbf{P} - \mathbf{a}$) can be expressed as a linear combination of these vectors.
                    \pause
                    \item We can express $\mathbf{P}$ as:
                        \begin{align*}
                            \mathbf{P} &= \mathbf{a} + \beta(\mathbf{b}-\mathbf{a}) + \gamma(\mathbf{c}-\mathbf{a}) \\
                            &= \alpha \mathbf{a} + \beta \mathbf{b} + \gamma \mathbf{c}
                        \end{align*}
                        Where $\alpha = 1 - \beta - \gamma$.
                \end{itemize}
            \end{mathbox}
           
            

        \end{column}
        \begin{column}{0.35\textwidth}
            \begin{tikzpicture}[scale=0.7]
                \begin{scope}[canvas is xy plane at z=0]
                    % Triangle
                    \coordinate (A) at (0,0);
                    \coordinate (B) at (4,0);
                    \coordinate (C) at (2,3);
                    
                    \draw[thick, ObjectColor, fill=ObjectColor!15] (A) -- (B) -- (C) -- cycle;
                    
                    % Vertices with weights
                    \fill[ObjectColor] (A) circle (3pt);
                    \fill[ObjectColor] (B) circle (3pt);
                    \fill[ObjectColor] (C) circle (3pt);
                    \node[below] at (A) {$\mathbf{a}$};
                    \node[below] at (B) {$\mathbf{b}$};
                    \node[above] at (C) {$\mathbf{c}$};

                    \draw[->, red, very thick] (A) -- (B) node[midway, below] {$\mathbf{e_1} = \mathbf{b}-\mathbf{a}$}; 
                    \draw[->, blue, very thick] (A) -- (C) node[midway, left] {$\mathbf{e_2} = \mathbf{c}-\mathbf{a}$};
                    
                    % Point P
                    \coordinate (P) at (2.2,1.2);
                    \fill[AccentColor] (P) circle (3pt);
                    \node[right] at (P) {\textcolor{AccentColor}{$\mathbf{P}$}};
                    \draw[->, thin, PrimaryColor, dashed] (A) -- (P);
                \end{scope}
            \end{tikzpicture}
        \end{column}
    \end{columns}
\end{frame}


\begin{frame}{Barycentric Coordinates: Derivation}
    \begin{columns}
        \begin{column}{0.65\textwidth}
            \begin{mathbox}{Area Interpretation}
                \begin{itemize}
                    \small
                    \item  Let $\hat{\mathbf{u}}$ be an unit vector in the direction of the altitude towards $C$. 
                    \pause
                    \item  The height of the triangle is $h = \hat{\mathbf{u}} \cdot (\mathbf{c} - \mathbf{a})$ (projection).
                    \pause
                    \item  The height of the shaded triangle is $h' = \hat{\mathbf{u}} \cdot (\mathbf{P} - \mathbf{a})$.
                    \pause
                    \item  Hence, \begin{align*}
                        A_{\gamma} &= \frac{1}{2} \cdot h' \cdot |\mathbf{b} - \mathbf{a}| \\
                        &= \frac{1}{2} \cdot \left (\hat{\mathbf{u}} \cdot (\mathbf{P} - \mathbf{a}) \right ) \cdot |\mathbf{b} - \mathbf{a}|  \\
                        &= \frac{1}{2} \cdot \gamma \left (\hat{\mathbf{u}} \cdot (\mathbf{c} - \mathbf{a}) \right ) \cdot |\mathbf{b} - \mathbf{a}|  \\
                        &= \gamma \frac{1}{2} \cdot h \cdot |\mathbf{b} - \mathbf{a}| = \gamma A_{total}
                    \end{align*}
                \end{itemize}
            \end{mathbox}    
        \end{column}
        \begin{column}{0.35\textwidth}
            \begin{tikzpicture}[scale=0.7]
                \begin{scope}[canvas is xy plane at z=0]
                    % Triangle
                    \coordinate (A) at (0,0);
                    \coordinate (B) at (4,0);
                    \coordinate (C) at (2,3);
                    
                    \draw[thick, ObjectColor, fill=ObjectColor!15] (A) -- (B) -- (C) -- cycle;
                    
                    % Vertices with weights
                    \fill[ObjectColor] (A) circle (3pt);
                    \fill[ObjectColor] (B) circle (3pt);
                    \fill[ObjectColor] (C) circle (3pt);
                    \node[below] at (A) {$\mathbf{a}$};
                    \node[below] at (B) {$\mathbf{b}$};
                    \node[above] at (C) {$\mathbf{c}$};

                    \draw[->, red, very thick] (A) -- (B) node[midway, below] {$\mathbf{b}-\mathbf{a}$}; 
                    
                    % Point P
                    \coordinate (P) at (1.7,1.6);
                    \fill[AccentColor] (P) circle (3pt);
                    \node[left] at (P) {\textcolor{AccentColor}{$\mathbf{P}$}};
                    \fill[red!60, opacity=0.2] (A) -- (P) -- (B) -- cycle;
                    \draw[PrimaryColor, dashed, thin] (A) -- (P) -- (B);

                    \draw[->, blue, thick] (2, 0) -- (2, 1) node[midway, right] {$\hat{\mathbf{u}}$};
                    \draw[gray, thin] (2, 0) -- (2, 3) node[midway, right, yshift=0.3cm] {\small $h$};
                    \draw[gray, thin] (1.7, 0) -- (1.7, 1.6) node[midway, left, xshift=0.1cm] {\small $h'$};


                    \node[red] at (1,0.4) {$A_{\gamma}$};
                \end{scope}
            \end{tikzpicture}
            \vspace{0.3cm}
            \only<5->{
            \footnotesize
                Since, $\mathbf{P} = \mathbf{a} + \beta (\mathbf{b} - \mathbf{a}) + \gamma (\mathbf{c} - \mathbf{a})$, 
                \begin{align*}
                    \mathbf{P} - \mathbf{a} = \beta (\mathbf{b} - \mathbf{a}) + \gamma (\mathbf{c} - \mathbf{a}) \\
                    \hat{\mathbf{u}} \cdot (\mathbf{P} - \mathbf{a}) = \gamma (\hat{\mathbf{u}} \cdot (\mathbf{c} - \mathbf{a}))
                \end{align*}
                Since $\hat{\mathbf{u}}$ is perpendicular to $\mathbf{b} - \mathbf{a}$.
            }
        \end{column}
    \end{columns}
\end{frame}



\begin{frame}{Method 1: Two-Step Ray-Triangle Intersection}
    \begin{columns}
        \begin{column}{0.65\textwidth}
            \begin{mathbox}{Algorithm Steps}
                \textbf{Step 1:} Ray-Plane Intersection
                \begin{align*}
                   t = -\frac{D + \mathbf{n} \cdot \mathbf{R_o}}{\mathbf{n} \cdot \mathbf{R_d}}
                \end{align*}
                \only<2->{
                    \textbf{Step 2:} Inside/Outside Test
                    \begin{align*}
                        \mathbf{P} &= \mathbf{a} + \beta(\mathbf{b}-\mathbf{a}) + \gamma(\mathbf{c}-\mathbf{a})
                    \end{align*}
                    
                    Solve for $\beta$, $\gamma$ and check bounds.
                }
            \end{mathbox}
        \end{column}
        \begin{column}{0.35\textwidth}
            \begin{tikzpicture}[scale=0.6]
                % Step 1: Ray-plane intersection

                % Rays
                \coordinate (RayStart1) at (2.5,-1, 4);
                \draw[ray, orange] (RayStart1) -- (3.5,0);

                \begin{scope}[plane x={(0.707, 0, 0.707)}, plane y={(0, 1, 0)}, canvas is plane]
                    % Extended plane
                    \fill[blue!30, opacity=0.3] (-2,-1) rectangle (7,4);
                    \draw[blue!60, thin] (-2,-1) rectangle (7,4);
                    
                    % Triangle
                    \coordinate (A) at (0,0);
                    \coordinate (B) at (4,0);
                    \coordinate (C) at (2,3);
                    
                    \draw[thick, ObjectColor, fill=ObjectColor!20] (A) -- (B) -- (C) -- cycle;
                    
                    % Vertices
                    \fill[ObjectColor] (A) circle (2pt);
                    \fill[ObjectColor] (B) circle (2pt);
                    \fill[ObjectColor] (C) circle (2pt);
                    
                    % Plane intersection point (outside triangle)
                    \coordinate (PlaneHit) at (5,0.05);
                    \fill[orange] (PlaneHit) circle (3pt);
                    \node[right, orange] at (PlaneHit) {\small Step 1: Plane hit};
                    
                    \pause
                    % Triangle intersection point
                    \coordinate (TriHit) at (2,1);
                    \fill[AccentColor] (TriHit) circle (3pt);
                    \draw[ray, AccentColor] (PlaneHit) -- (TriHit);
                    \node[right, AccentColor, xshift=0.3cm] at (TriHit) {\small Step 2: Triangle hit};
                \end{scope}
                
            
            \end{tikzpicture}
        \end{column}
    \end{columns}
\end{frame}



\begin{frame}{Method 2: Direct Barycentric Intersection}
    \begin{columns}
        \begin{column}{0.65\textwidth}
            \begin{mathbox}{Direct Approach}
                \small
                Set ray equation equal to barycentric form:
                \begin{align*}
                    \mathbf{R_o} + t\mathbf{R_d} &= \mathbf{a} + \beta(\mathbf{b}-\mathbf{a}) + \gamma(\mathbf{c}-\mathbf{a})
                \end{align*}
                
                Rearrange to linear system:
                \begin{align*}
                    \begin{bmatrix}
                        -\mathbf{R_d} & (\mathbf{b}-\mathbf{a}) & (\mathbf{c}-\mathbf{a})
                    \end{bmatrix}
                    \begin{bmatrix}
                        t \\ \beta \\ \gamma
                    \end{bmatrix}
                    = \mathbf{R_o} - \mathbf{a}
                \end{align*}
                
                Solve using Cramer's rule or \\ LU decomposition.
            \end{mathbox}
        \end{column}
        \begin{column}{0.35\textwidth}
                \begin{tikzpicture}[scale=0.6]
                % Step 1: Ray-plane intersection


                \begin{scope}[plane x={(0.707, 0, 0.707)}, plane y={(0, 1, 0)}, canvas is plane]
                    % Extended plane
                    \fill[blue!30, opacity=0.3] (-2,-1) rectangle (7,4);
                    \draw[blue!60, thin] (-2,-1) rectangle (7,4);
                    
                    % Triangle
                    \coordinate (A) at (0,0);
                    \coordinate (B) at (4,0);
                    \coordinate (C) at (2,3);
                    
                    \draw[thick, ObjectColor, fill=ObjectColor!20] (A) -- (B) -- (C) -- cycle;
                    
                    % Vertices
                    \fill[ObjectColor] (A) circle (2pt);
                    \fill[ObjectColor] (B) circle (2pt);
                    \fill[ObjectColor] (C) circle (2pt);
                    
                    % Plane intersection point (outside triangle)
                    \coordinate (PlaneHit) at (2.5,0.75);
                    \fill[orange] (PlaneHit) circle (3pt);
                    
                \end{scope}
                % Rays
                \coordinate (RayStart1) at (1,0, 4);
                \draw[ray, orange] (RayStart1) -- (2,1);
                           
            \end{tikzpicture}
        \end{column}
    \end{columns}
\end{frame}

\begin{frame}{Cramer's Rule Solution}
    \begin{mathbox}{Matrix Form}
        \vspace{-0.5cm}
        \small
        \begin{align*}
            \underbrace{
                \begin{bmatrix}
                    -R_{dx} & (b_x-a_x) & (c_x-a_x) \\
                    -R_{dy} & (b_y-a_y) & (c_y-a_y) \\
                    -R_{dz} & (b_z-a_z) & (c_z-a_z)
                \end{bmatrix}
            }_{A}
            \begin{bmatrix}
                t \\ \beta \\ \gamma
            \end{bmatrix}
            =
            \begin{bmatrix}
                R_{ox} - a_x \\
                R_{oy} - a_y \\
                R_{oz} - a_z
            \end{bmatrix}
        \end{align*}
    \end{mathbox}
    \vspace{-0.1cm}
    \pause
    \begin{columns}
        \begin{column}{0.6\textwidth}
            \begin{mathbox}{Cramer's Rule}
                \vspace{-0.3cm}
                \footnotesize
                \begin{align*}
                    t &= \frac{1}{|A|} \begin{vmatrix}
                        (R_o-a)_x & (b-a)_x & (c-a)_x \\
                        (R_o-a)_y & (b-a)_y & (c-a)_y \\
                        (R_o-a)_z & (b-a)_z & (c-a)_z
                    \end{vmatrix} \\
                    \beta &= \frac{1}{|A|} \begin{vmatrix}
                        -R_{dx} & (R_o-a)_x & (c-a)_x \\
                        -R_{dy} & (R_o-a)_y & (c-a)_y \\
                        -R_{dz} & (R_o-a)_z & (c-a)_z
                    \end{vmatrix} \\
                    \gamma &= \frac{1}{|A|} \begin{vmatrix}
                        -R_{dx} & (b-a)_x & (R_o-a)_x \\
                        -R_{dy} & (b-a)_y & (R_o-a)_y \\
                        -R_{dz} & (b-a)_z & (R_o-a)_z
                    \end{vmatrix}
                \end{align*}
            \end{mathbox}
        \end{column}
        \pause
        \begin{column}{0.4\textwidth}
            \begin{conceptbox}{Checks}
                \footnotesize
                \begin{itemize}
                    \item $t_{\text{min}} < t < t_{\text{current}}$ (valid intersection)
                    \item $\beta, \gamma \geq 0$ and $\beta + \gamma \leq 1$ \\ (inside triangle)
                \end{itemize}
            \end{conceptbox}
        \end{column}
    \end{columns}
\end{frame}

{
    \setbeamercolor{background canvas}{bg=PrimaryColor!30, fg=black}
    \begin{frame}{Cramer's Rule Intuition}
        \begin{columns}
            \begin{column}{0.65\textwidth}
                \begin{mathbox}{Determinant Interpretation}
                    Remember, $\beta = \frac{A_{\beta}}{A_{total}}$? \\

                    Determinants measure areas of projected triangles.
                    \begin{align*}
                        \begin{vmatrix}
                            -R_{dx} & (b_x-a_x) & (c_x-a_x) \\
                            -R_{dy} & (b_y-a_y) & (c_y-a_y) \\
                            -R_{dz} & (b_z-a_z) & (c_z-a_z)
                        \end{vmatrix} &\propto A_{total} \\
                        \begin{vmatrix}
                            -R_{dx} & (R_o-a)_x & (c-a)_x \\
                            -R_{dy} & (R_o-a)_y & (c-a)_y \\
                            -R_{dz} & (R_o-a)_z & (c-a)_z
                        \end{vmatrix} &\propto A_{\beta}
                    \end{align*}
                    
                    \textbf{Why?}
                \end{mathbox}
                
            \end{column}
            \begin{column}{0.35\textwidth}
                \centering
                \begin{tikzpicture}[scale=0.6]
                    \begin{scope}[canvas is xy plane at z=0]
                        % Triangle
                        \coordinate (A) at (0,0);
                        \coordinate (B) at (4,0);
                        \coordinate (C) at (2,3);
                        
                        \draw[thick, ObjectColor, fill=ObjectColor!15] (A) -- (B) -- (C) -- cycle;
                        
                        % Vertices with weights
                        \fill[ObjectColor] (A) circle (3pt);
                        \fill[ObjectColor] (B) circle (3pt);
                        \fill[ObjectColor] (C) circle (3pt);
                        \node[below] at (A) {$\mathbf{a}$};
                        \node[below] at (B) {$\mathbf{b}$};
                        \node[above] at (C) {$\mathbf{c}$};
                        
                        % Point P
                        \coordinate (P) at (2.2,1.2);
                        \fill[AccentColor] (P) circle (3pt);
                        \node[below] at (P) {\textcolor{AccentColor}{$\mathbf{P}$}};
                        
                        % Sub-triangles for area interpretation
                        \draw[thin, SecondaryColor, dashed] (P) -- (A);
                        \draw[thin, SecondaryColor, dashed] (P) -- (B);
                        \draw[thin, SecondaryColor, dashed] (P) -- (C);
                        
                        % Area labels
                        \fill[blue!25, opacity=0.5] (A) -- (C) -- (P) -- cycle;

                        \node[blue] at (1.6,1.7) {$A_{\beta}$};


                    \end{scope}
                \end{tikzpicture}
            \end{column}
        \end{columns}
    \end{frame}

        \begin{frame}{Cramer's Rule Intuition}
        \begin{columns}
            \begin{column}{0.65\textwidth}
                \begin{mathbox}{Determinant Interpretation}
                    \only<1>{
                        The areas can be found by cross products of vectors. Consider |
                        \begin{align*}
                            \mathbf{N} &= \mathbf{(\mathbf{b} - \mathbf{a})} \times \mathbf{(\mathbf{c} - \mathbf{a})} \\
                            &= \begin{vmatrix}
                                \mathbf{i} & \mathbf{j} & \mathbf{k} \\
                                b_x - a_x & b_y - a_y & b_z - a_z \\
                                c_x - a_x & c_y - a_y & c_z - a_z
                            \end{vmatrix} \\
                            &= 2 A_{total} \hat{\mathbf{n}} 
                        \end{align*}
                        $\mathbf{N}$ is the normal vector of the triangle scaled by twice the area.
                    }
                    \only<2>{
                        We project the triangle onto the plane perpendicular to the ray direction $\mathbf{R_d}$.
                    }
                    \only<3>{
                        $\mathbf{N} \cdot (-\mathbf{R}_d)$ is twices the projected area of the triangle 
                                onto the plane perpendicular to the ray direction.                       
                        \begin{align*}
                            \mathbf{N} \cdot (-\mathbf{R}_d)
                            &= \begin{vmatrix}
                                -R_x & -R_y & -R_z \\
                                b_x - a_x & b_y - a_y & b_z - a_z \\
                                c_x - a_x & c_y - a_y & c_z - a_z
                            \end{vmatrix} \\
                            &= \begin{vmatrix}
                                -R_x & b_x - a_x & c_x - a_x \\
                                -R_y & b_y - a_y & c_y - a_y \\
                                -R_z & b_z - a_z & c_z - a_z
                            \end{vmatrix} \\
                            & \propto A_{total} 
                        \end{align*}
                    }
                    \only<4>{
                        Now what about the $A_\gamma$ triangle? \\
                        Same idea but a bit different.
                    }
                    \only<5>{
                        \begin{itemize}
                            \item Instead of projecting the triangle between $\mathbf{a}$, $\mathbf{c}$ and $\mathbf{P}$, 
                        we project the triangle between $\mathbf{a}$, $\mathbf{c}$ and $\mathbf{R}_o$.
                            \item From the perspective of the ray,
                        points $\mathbf{P}$ and $\mathbf{R}_o$ are the same point, as both fall on the ray.
                        \end{itemize}
                    }
                    \only<6>{
                        (Twice) the area of the triangle between $\mathbf{a}$, $\mathbf{c}$ and $\mathbf{R}_o$ projected onto the plane perpendicular to the ray direction $\mathbf{R}_d$ is given by:
                        \begin{align*}
                            & (\mathbf{R}_o - \mathbf{a}) \times (\mathbf{c} - \mathbf{a}) \cdot (-\mathbf{R}_d) \\
                            =& \begin{vmatrix}
                                -R_x & -R_y & -R_z \\
                                b_x - a_x & b_y - a_y & b_z - a_z \\
                                R_{ox} - a_x & R_{oy} - a_y & R_{oz} - a_z
                            \end{vmatrix} \\
                            &\propto A_{\gamma}
                        \end{align*}
                    }
                \end{mathbox}
                
            \end{column}
            \begin{column}{0.35\textwidth}
                \centering
                \begin{tikzpicture}[scale=0.5]
                    % Point P
                    \coordinate (P) at (2.2,1.2,0);
                    \coordinate (Ro) at ($(2.2,1.2,0)-8*(-0.707,0,-0.707)$);
                    \coordinate (Rd) at ($(2.2,1.2,0)-5*(-0.707,0,-0.707)$);
                    \coordinate (Rf) at ($(2.2,1.2,0)+8*(-0.707,0,-0.707)$);
                    \begin{scope}[canvas is xy plane at z=0]
                        % Triangle
                        \coordinate (A) at (0,0);
                        \coordinate (B) at (4,0);
                        \coordinate (C) at (2,3);
                        
                        \draw[thick, ObjectColor, fill=ObjectColor!15] (A) -- (B) -- (C) -- cycle;
                        
                        % Vertices with weights
                        \fill[ObjectColor] (A) circle (3pt);
                        \fill[ObjectColor] (B) circle (3pt);
                        \fill[ObjectColor] (C) circle (3pt);
                        \node[below] at (A) {$\mathbf{a}$};
                        \node[below] at (B) {$\mathbf{b}$};
                        \node[above] at (C) {$\mathbf{c}$};
                        
                        
                        % Sub-triangles for area interpretation
                        \draw[thin, SecondaryColor, dashed] (P) -- (A);
                        \draw[thin, SecondaryColor, dashed] (P) -- (B);
                        \draw[thin, SecondaryColor, dashed] (P) -- (C);
                        
                        % Area labels
                        \fill[blue!25, opacity=0.5] (A) -- (C) -- (P) -- cycle;

                        \node[blue] at (1.6,1.7) {$A_{\beta}$};
                    \end{scope}

                    \fill[AccentColor] (P) circle (3pt);
                    \node[below] at (P) {\textcolor{AccentColor}{$\mathbf{P}$}};
                    \draw[blue, ->] (P) --++ (0, 0, 6) node[right] {$\mathbf{N}$};
                    \only<5->{
                        \draw[thick, green, fill=green!30, opacity=0.5] (Ro) -- (A) -- (C) -- cycle;
                    }
                    \only<4->{
                        \fill[blue!50, opacity=0.5] (A) -- (C) -- (P) -- cycle;
                        \node[blue] at (1.6,1.7) {$A_{\beta}$};
                    }
                    \only<2->{    
                        \begin{scope}[
                            plane origin={(2.2, 1.2, 0)},
                            plane x={(2.907, 1.2, -0.707)},
                            plane y={(2.2, 2.2, 0)},
                            canvas is plane    
                        ]
                            \draw[PrimaryColor!60, opacity=0.8] (-3,-3) rectangle (3,3);
                            \fill[PrimaryColor!60, opacity=0.5] (-3,-3) rectangle (3,3);

                            \coordinate (A1) at (-1.556,-1.2);
                            \coordinate (B1) at (1.273,-1.2);
                            \coordinate (C1) at (-0.141,1.8);
                            \only<3,6->{
                                \draw[thick, red, fill=red!15, opacity=0.3] (A1) -- (B1) -- (C1) -- cycle;
                            }
                            \only<6->{
                                \draw[thick, orange, fill=orange!80, opacity=0.3] (P) -- (A1) -- (C1) -- cycle;
                            }
                        \end{scope}
                        \draw[PrimaryColor,fill=PrimaryColor] (Ro) circle (2pt) node[below] {$\mathbf{R_o}$};
                        \draw[ray] (Ro) -- (Rf);
                        \draw[->, red, thick] (Ro) -- (Rd) node[midway, above] {$\mathbf{R_d}$};
                    }
                \end{tikzpicture}
            \end{column}
        \end{columns}
    \end{frame}
}


\begin{frame}{Bonus of Using Barycentric Coordinates}
    \begin{columns}
        \begin{column}{0.5\textwidth}
            \begin{conceptbox}{Advantages}
                \begin{itemize}
                    \item Efficient to compute
                    \item Get Barycentric coordinates for free
                    \item Enables interpolation of vertex attributes\\
                    Used in |
                    \begin{itemize}
                        \item Textures
                        \item Normals
                        \item Colors
                    \end{itemize}
                \end{itemize}
            \end{conceptbox}
        \end{column}
        \begin{column}{0.5\textwidth}
            \begin{tikzpicture}[scale=0.6]
            % define the triangle vertices via polar coords
            \coordinate (A) at (90:4);    % top
            \coordinate (B) at (210:4);   % left
            \coordinate (C) at (-30:4);   % right

            % 1) paint full triangle green
            \fill[green] (A) -- (B) -- (C) -- cycle;

            % 2) overpaint blue, fading out towards the west edge
            \fill[blue,
                    path fading=west      % fades toward the left
                ]
                (A) -- (B) -- (C) -- cycle;

            % 3) overpaint red, fading out towards the south edge
            \fill[red,
                    path fading=south      % fades toward the bottom
                ]
                (A) -- (B) -- (C) -- cycle;

            % outline & vertex markers
            \draw[black, thick] (A) -- (B) -- (C) -- cycle;
            \fill[red]   (A) circle (3pt) node[above]      {$A$};
            \fill[green] (B) circle (3pt) node[below left] {$B$};
            \fill[blue]  (C) circle (3pt) node[below right]{$C$};

            % example interior point
            \coordinate (P) at (0, 0);
            \fill[white] (P) circle (2pt) node[right] {$P$};
            \node[below, white, yshift=-0.2cm] at (P) {\small $\alpha R + \beta G + \gamma B$};
            \end{tikzpicture}
        \end{column}
    \end{columns}
\end{frame}


\begin{frame}{Ray-Sphere Intersection Overview}
    \begin{columns}
        \begin{column}{0.65\textwidth}
            \begin{conceptbox}{Two Main Approaches}
                \textbf{Method 1: Algebra}
                \begin{enumerate}
                    \item Setup quadratic equation
                    \item Solve for t
                \end{enumerate}
                
                \vspace{0.5cm}
                \textbf{Method 2: Geometry}
                \begin{enumerate}
                    \item Use geomety to find intersection step by step
                    \item Reject early if hit is not possible
                \end{enumerate}
            \end{conceptbox}
        \end{column}
        \begin{column}{0.35\textwidth}
            \begin{tikzpicture}[scale=0.8]
                \draw[thick, ObjectColor] (0, 0) circle (1);
                \fill[ObjectColor!20, opacity=0.6] (0, 0) circle (1);
                \coordinate (A) at (170:1);
                \coordinate (B) at (40:1);
                \coordinate (M) at ($0.5*(A)+0.5*(B)$);
                \begin{scope}[shift={(M)}, rotate=15]
                    % Ray
                    \draw[ray, very thick] (-3, 0) -- (2, 0);
                    \fill[PrimaryColor] (-3, 0) circle (2pt);
                    \node[below] at (-3, 0) {$\mathbf{R_o}$};
                    % Direction vector
                    \draw[->, red, thick] (-3, 0) -- (-1.5, 0) node[midway, above, shift={(-0.2,0)}] {$\mathbf{R_d}$};
                \end{scope}
                \fill[AccentColor] (A) circle (2pt);
                \fill[AccentColor] (B) circle (2pt);
                \fill[ObjectColor] (0, 0) circle (2pt);
            \end{tikzpicture}
        \end{column}
    \end{columns}
\end{frame}


\begin{frame}{Sphere Representation}
    \begin{columns}
        \begin{column}{0.6\textwidth}
            \begin{mathbox}{Implicit Sphere Equation}
                \textbf{Sphere centered at origin:}
                \begin{align*}
                    \mathbf{P} \cdot \mathbf{P} - r^2 = 0 \\
                    x^2 + y^2 + z^2 - r^2 = 0
                \end{align*}
                
                \textbf{General sphere at center $\mathbf{C}$:}
                \begin{align*}
                    (\mathbf{P} - \mathbf{C}) \cdot (\mathbf{P} - \mathbf{C}) - r^2 = 0
                \end{align*}
                
                \vspace{0.3cm}
                \textbf{Note:} Translation to origin simplifies calculation!
            \end{mathbox}
        \end{column}
        \begin{column}{0.4\textwidth}
            \begin{tikzpicture}[scale=0.8]
                % 3D coordinate system
                \draw[->] (0,0) -- (3,0) node[right] {$x$};
                \draw[->] (0,0) -- (0,3) node[above] {$y$};
                \draw[->] (0,0) -- (-1,-1) node[below left] {$z$};
                
                % Sphere
                \draw[thick, ObjectColor] (1.5,1.5) circle (1.2);
                \fill[ObjectColor!20, opacity=0.6] (1.5,1.5) circle (1.2);
                
                % Center point
                \fill[ObjectColor] (1.5,1.5) circle (2pt);
                \node[below right] at (1.5,1.5) {$\mathbf{C}$};
                
                \begin{scope}[shift={(1.5,1.5)}]
                    % Radius
                    \draw[<->, SecondaryColor, thick] (0, 0) -- (30:1.2);
                    \node[above] at (30:0.4) {$r$};
                % Point on sphere
                    \fill[AccentColor] (30:1.2) circle (2pt);
                    \node[above] at (30:1.2) {$\mathbf{P}$};
                \end{scope}
            \end{tikzpicture}
        \end{column}
    \end{columns}
\end{frame}

\begin{frame}{Ray-Sphere Intersection: Algebraic Method}
    \begin{columns}
        \begin{column}{0.6\textwidth}
            \begin{mathbox}{Algebraic Solution}
                \only<1>{
                    \textbf{Step 1:} Substitute ray equation $\mathbf{P}(t) = \mathbf{R_o} + t\mathbf{R_d}$ into sphere
                    \begin{align*}
                        & (\mathbf{R_o} + t\mathbf{R_d}) \cdot (\mathbf{R_o} + t\mathbf{R_d}) - r^2 = 0
                    \end{align*}
                }
                \only<2>{
                    \textbf{Step 2:} Expand and rearrange
                    \begin{align*}
                        \mathbf{R_d} \cdot \mathbf{R_d} t^2 + 2\mathbf{R_d} \cdot \mathbf{R_o} t \\
                        + \mathbf{R_o} \cdot \mathbf{R_o} - r^2 = 0
                    \end{align*}
                }                
                \only<3->{
                    \textbf{Step 3:} Quadratic formula \\ 
                    ($ax^2 + bx + c = 0$)
                    \begin{align*}
                        a &= \mathbf{R_d} \cdot \mathbf{R_d} = 1 \text{ (normalized)} \\
                        b &= 2\mathbf{R_d} \cdot \mathbf{R_o} \\
                        c &= \mathbf{R_o} \cdot \mathbf{R_o} - r^2
                    \end{align*}
                }
            \end{mathbox}
        \end{column}
        \begin{column}{0.4\textwidth}
            \begin{tikzpicture}[scale=0.8]
                    % Sphere
                \draw[thick, ObjectColor] (0, 0) circle (1);
                \fill[ObjectColor!20, opacity=0.6] (0, 0) circle (1);
       
                \coordinate (A) at (170:1);
                \coordinate (B) at (40:1);
                \coordinate (M) at ($0.5*(A)+0.5*(B)$);
                \begin{scope}[shift={(M)}, rotate=15]
                    % Ray
                    \draw[ray, very thick] (-3, 0) -- (2, 0);
                    \fill[PrimaryColor] (-3, 0) circle (2pt);
                    \node[below] at (-3, 0) {$\mathbf{R_o}$};
                    % Direction vector
                    \draw[->, red, thick] (-3, 0) -- (-1.5, 0) node[midway, above, shift={(-0.2,0)}] {$\mathbf{R_d}$};
                \end{scope}
                \only<4->{
                    \fill[AccentColor] (A) circle (2pt);
                    \fill[AccentColor] (B) circle (2pt);

                    \node[above left] at (A) {$t_-$};
                    \node[above right] at (B) {$t_+$};
                }
                % Center
                \fill[ObjectColor] (0, 0) circle (2pt);
                % Radius
                \draw[<->, SecondaryColor] (0, 0) -- (0:1) node[midway, below] {$r$};
            \end{tikzpicture}
        \end{column}
    \end{columns}
    
    \only<4->{
        \begin{mathbox}{Discriminant Analysis}
            \vspace{-0.5cm}
            \begin{align*}
                \Delta &= b^2 - 4ac = (2\mathbf{R_d} \cdot \mathbf{R_o})^2 - 4(\mathbf{R_o} \cdot \mathbf{R_o} - r^2) \\
                t_{\pm} &= \frac{-b \pm \sqrt{\Delta}}{2a} = -\mathbf{R_d} \cdot \mathbf{R_o} \pm \frac{\sqrt{\Delta}}{2}
            \end{align*}
        \end{mathbox}
    }
\end{frame}

\begin{frame}{Algebraic Method: Three Cases}
    The discriminant $\Delta$ determines the number of intersections:
    \begin{columns}
        \begin{column}{0.33\textwidth}
            \begin{conceptbox}{$\Delta > 0$}
                \textbf{2 intersections}
                \begin{center}
                    \begin{tikzpicture}[scale=0.6]
                        \draw[thick, ObjectColor] (1,1) circle (0.8);
                        \fill[ObjectColor!20, opacity=0.6] (1,1) circle (0.8);
                        \draw[ray, very thick] (-0.5,0.5) -- (2.5,1.5);
                        \fill[AccentColor] (0.25,0.75) circle (1.5pt);
                        \fill[AccentColor] (1.75,1.25) circle (1.5pt);
                        \node[below] at (0.2,0.75) {\tiny $t_-$};
                        \node[above] at (1.85,1.25) {\tiny $t_+$};
                    \end{tikzpicture}                    
                \end{center}
                
                Choose closest positive \\ (usually $t_-$)
            \end{conceptbox}
        \end{column}
        \begin{column}{0.33\textwidth}
            \begin{conceptbox}{$\Delta \text{ = } 0$}
                \textbf{1 intersection}
                \begin{center}
                     \begin{tikzpicture}[scale=0.6]
                        \draw[thick, ObjectColor] (1,1) circle (0.8);
                        \fill[ObjectColor!20, opacity=0.6] (1,1) circle (0.8);
                        \draw[ray, very thick] (-0.5,0.2) -- (2.5,0.2);
                        \fill[AccentColor] (1,0.2) circle (1.5pt);
                        \node[below] at (1,0.2) {\tiny tangent};
                    \end{tikzpicture}               
                \end{center}                
                Ray tangent to sphere
                \vspace{0.3cm}
            \end{conceptbox}
        \end{column}
        \begin{column}{0.33\textwidth}
            \begin{conceptbox}{$\Delta < 0$}
                \textbf{No intersection}
                \begin{center}                    
                    \begin{tikzpicture}[scale=0.6]
                        \draw[thick, ObjectColor] (1,1.5) circle (0.8);
                        \fill[ObjectColor!20, opacity=0.6] (1,1.5) circle (0.8);
                        \draw[ray, very thick] (-0.5,0.2) -- (2.5,0.2);
                    \end{tikzpicture}
                \end{center}                
                Ray doesn't hit sphere
                \vspace{0.5cm}
            \end{conceptbox}
        \end{column}
    \end{columns}
    
    \vspace{0.5cm}
    \begin{mathbox}{Additional Check}
        Remember to check $t_{\text{min}}$ to find closest valid intersection.
    \end{mathbox}
\end{frame}

\begin{frame}{Ray-Sphere Intersection: Geometric Method}
    \begin{columns}
        \begin{column}{0.6\textwidth}
            \begin{mathbox}{Geometric Approach}
                \only<1>{
                    \textbf{Step 1:} Check ray origin position
                    \begin{align*}
                        \text{Inside: } &\mathbf{R_o} \cdot \mathbf{R_o} < r^2 \\
                        \text{Outside: } &\mathbf{R_o} \cdot \mathbf{R_o} > r^2 \\
                        \text{On surface: } &\mathbf{R_o} \cdot \mathbf{R_o} = r^2
                    \end{align*}

                }
                \only<2>{
                    \textbf{Step 2:} Find parameter $t_p$ for the point on the ray closest to the sphere center
                    \begin{align*}
                        t_P &= -\mathbf{R_o} \cdot \mathbf{R_d}
                    \end{align*}
                }
                \only<3>{
                    \textbf{Step 3:} Early rejection test
                    \begin{align*}
                        \text{If outside \& } t_P < 0 \Rightarrow \text{no hit}
                    \end{align*}
                }
                \only<4>{
                    \textbf{Step 4:} Find squared distance to sphere center
                    \begin{align*}
                        d^2 &= \mathbf{R_o} \cdot \mathbf{R_o} - t_P^2
                    \end{align*}
                }

                \only<5>{
                    \textbf{Step 5:} Second rejection test
                    \begin{align*}
                        \text{If } d^2 > r^2 \Rightarrow \text{no hit}
                    \end{align*}
                }
                
                \only<6>{
                    \textbf{Step 6:} Find intersection distance
                    \begin{align*}
                        t'^2 &= r^2 - d^2 \\
                        t' &= \sqrt{r^2 - d^2}
                    \end{align*}
                }
                
                \only<7->{
                    \textbf{Step 7:} Choose correct intersection parameter
                    \begin{align*}
                        \textbf{Outside: } &t_{-} = t_P - t' \\
                        \textbf{Inside: } &t_{+} = t_P + t'
                    \end{align*}
                    $t_{min} < t_{\pm} < t_{current} \Rightarrow$ hit 
                }
            \end{mathbox}
        \end{column}
        \begin{column}{0.4\textwidth}
            \begin{tikzpicture}[scale=0.8]
                    % Sphere
                \draw[thick, ObjectColor] (0, 0) circle (1);
                \fill[ObjectColor!20, opacity=0.6] (0, 0) circle (1);
                
                % Ray
                \draw[ray, very thick] (210:3) -- (3:2.5);
                \fill[PrimaryColor] (210:3) circle (2pt);
                
                % Direction vector
                \draw[->, red, thick] (210:3) --++ (1.4306, 0.451) node[midway, below, shift={(0.2,0)}] {$\mathbf{R_d}$};

                \coordinate (t1) at (238:1);
                \coordinate (t2) at (-22:1);
                \coordinate (M) at ($0.5*(t1)+0.5*(t2)$);

                \only<2->{
                    \fill[AccentColor] (t1) circle (2pt);
                    \fill[AccentColor] (t2) circle (2pt);
                    \fill[AccentColor] (M) circle (2pt);


                    \draw[gray!60, thin] (0, 0) -- (M);

                    
                    \begin{scope}[shift={(M)}, rotate=18]                        
                        \draw[gray!60, thin] (0.25,0) |- (0, 0.25);
                        \only<2->{                            
                            \draw[<->, gray, thin] (0, -0.8) --++ (-3, 0) node[midway, below] {$t_p $};
                        }
                        \only<4->{                            
                            \draw[<->, gray, thin] (-0.2, 0) --++ (0, 0.65) node[midway, left] {$d$};
                        }
                        \only<6->{                           
                            \draw[<->, AccentColor, thin] (0, -0.8) --++ (0.8, 0) node[midway, below,shift={(0.1,0)}] {$t' $};
                        }
                    \end{scope}

                }

                    
                \only<7->{
                    \node[below] at (t1) {$t_-$};
                    \node[below right] at (t2) {$t_+$};
                }

                
                % Center
                \fill[ObjectColor] (0, 0) circle (2pt);

          
                \draw[<->, SecondaryColor] (0, 0) -- (t2) node[midway, above] {$r$};
    
                % Radius
                \alt<2>{
                    \draw[<-, AccentColor, thin] (0, 0) -- (210:3) node[midway, above, xshift=-0.2cm] {$\mathbf{-R_o}$};
                }{
                    \node[left, AccentColor] at (210:3) {$\mathbf{R_o}$};
                }
            \end{tikzpicture}
        \end{column}
    \end{columns}
    \only<8->{
        \begin{conceptbox}{Benefits of Method}
            \begin{itemize}
                \item \textbf{Early rejection:} Avoid extra work for rays missing sphere
                \item \textbf{Optimized:} Efficient for rays outside pointing away
            \end{itemize}
        \end{conceptbox}
    }
\end{frame}


\begin{frame}{General Quadric Surfaces}
    \begin{columns}
        \begin{column}{0.6\textwidth}
            \begin{mathbox}{Quadric Surface Definition}
                General equation:
                \begin{align*}
                    Ax^2 + By^2 + Cz^2 + Dxy + Eyz \\ + Fxz
                    + Gx + Hy + Iz + J = 0
                \end{align*}
                
                \textbf{Common Quadric Surfaces:}
                \begin{itemize}
                    \item \textbf{Ellipsoid:} $\frac{x^2}{a^2} + \frac{y^2}{b^2} + \frac{z^2}{c^2} = 1$
                    \item \textbf{Cone:} $\frac{x^2}{a^2} - \frac{y^2}{b^2} + \frac{z^2}{c^2} = 0$
                    \item \textbf{Cylinder:} $\frac{x^2}{a^2} + \frac{y^2}{b^2} = 1$
                    \item \textbf{Hyperboloid \& Paraboloid}
                \end{itemize}
            \end{mathbox}
        \end{column}
        \begin{column}{0.4\textwidth}
            \begin{tikzpicture}[scale=0.7]
                % 3D coordinate system
                \draw[->] (0,0) -- (3,0) node[right] {$x$};
                \draw[->] (0,0) -- (0,3) node[above] {$y$};
                \draw[->] (0,0) -- (-1,-1) node[below left] {$z$};
                
                % Ellipsoid representation
                \begin{scope}[canvas is xy plane at z=1]
                    \draw[thick, ObjectColor, fill=ObjectColor!20, opacity=0.6] 
                        (1.5,1.5) ellipse (1.2 and 0.8);
                \end{scope}
                
                % Ray intersecting ellipsoid
                \draw[ray, very thick] (-2,0) -- (3,2.5);
                \draw[->, red, thick] (-2,0) -- (-0.5,0.75) node[midway, above] {$\mathbf{R_d}$};
                
                % Intersection points
                \fill[AccentColor] (0.5,1.25) circle (2pt);
                \fill[AccentColor] (1.5,1.75) circle (2pt);
                \node[below] at (0.5,1.25) {\textcolor{AccentColor}{$t_1$}};
                \node[below] at (1.5,1.75) {\textcolor{AccentColor}{$t_2$}};
                
                \fill[AccentColor] (-2,0) circle (2pt);
                \node[below, AccentColor] at (-2,0)  {$\mathbf{R_o}$};
            \end{tikzpicture}
        \end{column}
    \end{columns}
    
    \vspace{0.3cm}
    \href{https://tutorial.math.lamar.edu/Classes/CalcIII/QuadricSurfaces.aspx}{\alert{Reference:} Quadric Surfaces in Paul's Online Notes}
\end{frame}

\begin{frame}{Ray-Quadric Surface Intersection}
    \begin{columns}
        \begin{column}{0.65\textwidth}
            \begin{mathbox}{Intersection Method}
                \only<1>{
                    \textbf{Step 1:} Substitute ray equation into quadric
                    \begin{align*}
                        \mathbf{P}(t) &= \mathbf{R_o} + t \cdot \mathbf{R_d}\\
                        P_x &= R_{0x} + t \cdot R_{dx}\\
                        P_y &= R_{0y} + t \cdot R_{dy}\\
                        P_z &= R_{0z} + t \cdot R_{dz}
                    \end{align*}
                }
                \only<2>{
                    \textbf{Step 2:} Results in quadratic equation
                    \begin{align*}
                        ax^2 + bx + c = 0
                    \end{align*}
                }
                \only<3>{
                    \textbf{Step 3:} Solve using quadratic formula
                    \begin{align*}
                        t = \frac{-b \pm \sqrt{b^2 - 4ac}}{2a}
                    \end{align*}
                }
            \end{mathbox}
        \end{column}
        \begin{column}{0.35\textwidth}
            \begin{tikzpicture}[scale=0.7]
                % 3D coordinate system
                \draw[->] (0,0) -- (3,0) node[right] {$x$};
                \draw[->] (0,0) -- (0,3) node[above] {$y$};
                \draw[->] (0,0) -- (-1,-1) node[below left] {$z$};
                
                % Ellipsoid representation
                \begin{scope}[canvas is xy plane at z=1]
                    \draw[thick, ObjectColor, fill=ObjectColor!20, opacity=0.6] 
                        (1.5,1.5) ellipse (1.2 and 0.8);
                \end{scope}
                
                % Ray intersecting ellipsoid
                \draw[ray, very thick] (-2,0) -- (3,2.5);
                \draw[->, red, thick] (-2,0) -- (-0.5,0.75) node[midway, above] {$\mathbf{R_d}$};
                
                % Intersection points
                \fill[AccentColor] (0.5,1.25) circle (2pt);
                \fill[AccentColor] (1.5,1.75) circle (2pt);
                \node[below] at (0.5,1.25) {\textcolor{AccentColor}{$t_1$}};
                \node[below] at (1.5,1.75) {\textcolor{AccentColor}{$t_2$}};
                
                \fill[AccentColor] (-2,0) circle (2pt);
                \node[below, AccentColor] at (-2,0)  {$\mathbf{R_o}$};
            \end{tikzpicture}
        \end{column}
    \end{columns}
    
    \pause
    \begin{conceptbox}{Solution Cases}
        Check the discriminant $b^2 - 4ac$:
        \begin{itemize}
            \item \textbf{Discriminant $> 0$:} Two real solutions (ray intersects surface twice)
            \item \textbf{Discriminant $= 0$:} One solution (ray tangent to surface)  
            \item \textbf{Discriminant $< 0$:} No real solutions (ray misses surface)
            \item \textbf{Accept:} Accept smaller $t$ such that $t_{\text{min}} < t < t_{\text{current}}$
        \end{itemize}
    \end{conceptbox}
\end{frame}